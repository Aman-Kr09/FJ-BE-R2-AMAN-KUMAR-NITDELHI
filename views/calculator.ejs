<%- include('partials/header') %>

    <div style="margin-top: 40px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Currency Calculator</h1>
            <p style="color: var(--text-muted);">Real-time exchange rates for global conversions</p>
        </div>

        <div class="stat-card" style="padding: 40px;">
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="calcAmount" value="1.00" step="0.01"
                    style="font-size: 1.5rem; padding: 15px; border-radius: 12px; background: var(--bg-main); color: white; border: 1px solid var(--border); width: 100%;">
            </div>

            <div style="display: flex; align-items: center; gap: 15px; margin: 20px 0;">
                <div class="form-group" style="flex: 1; margin: 0;">
                    <label>From</label>
                    <select id="calcFrom" class="currency-select"
                        style="width: 100%; border-radius: 12px; padding: 15px;">
                        <% currencies.forEach(curr=> { %>
                            <option value="<%= curr %>" <%=curr==='usd' ? 'selected' : '' %>><%= curr.toUpperCase() %>
                            </option>
                            <% }) %>
                    </select>
                </div>

                <button id="swapBtn"
                    style="background: none; border: 1px solid var(--border); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-top: 25px; color: var(--text-muted);">
                    <i data-lucide="arrow-right-left"></i>
                </button>

                <div class="form-group" style="flex: 1; margin: 0;">
                    <label>To</label>
                    <select id="calcTo" class="currency-select"
                        style="width: 100%; border-radius: 12px; padding: 15px;">
                        <% currencies.forEach(curr=> { %>
                            <option value="<%= curr %>" <%=curr==='inr' ? 'selected' : '' %>><%= curr.toUpperCase() %>
                            </option>
                            <% }) %>
                    </select>
                </div>
            </div>

            <div
                style="background: var(--bg-main); padding: 30px; border-radius: 16px; text-align: center; border: 1px dashed var(--border); margin-top: 30px;">
                <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 5px;" id="rateInfo">1 USD =
                    83.21 INR</div>
                <div id="resultValue" style="font-size: 2.5rem; font-weight: 700; color: var(--primary);">â‚¹ 83.21</div>
            </div>
        </div>
    </div>

    <div id="exchangeRates" data-rates='<%- rates %>'></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rates = JSON.parse(document.getElementById('exchangeRates').dataset.rates);
            const fromSelect = document.getElementById('calcFrom');
            const toSelect = document.getElementById('calcTo');
            const amountInput = document.getElementById('calcAmount');
            const swapBtn = document.getElementById('swapBtn');
            const resultValue = document.getElementById('resultValue');
            const rateInfo = document.getElementById('rateInfo');

            function calculate() {
                const amount = parseFloat(amountInput.value) || 0;
                const from = fromSelect.value;
                const to = toSelect.value;

                // Convert to USD first (assuming rates are USD based)
                const inUsd = amount / rates[from];
                const converted = inUsd * rates[to];

                const ratePerOne = (1 / rates[from]) * rates[to];

                rateInfo.textContent = `1 ${from.toUpperCase()} = ${ratePerOne.toFixed(4)} ${to.toUpperCase()}`;
                resultValue.textContent = `${converted.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ${to.toUpperCase()}`;
            }

            amountInput.addEventListener('input', calculate);
            fromSelect.addEventListener('change', calculate);
            toSelect.addEventListener('change', calculate);

            swapBtn.addEventListener('click', () => {
                const temp = fromSelect.value;
                fromSelect.value = toSelect.value;
                toSelect.value = temp;
                calculate();
            });

            calculate();
            lucide.createIcons();
        });
    </script>

    <%- include('partials/header') %>